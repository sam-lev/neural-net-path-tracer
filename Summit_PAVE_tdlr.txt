#module installs:
#    - pip2
#    - cmake
#    - python2 (for conda install of older pytorch for power9)
module load python/2.7.15    
module load py-setuptools/40.2.0-py2
module load py-pip/10.0.1-py2

#install anaconda from source
 wget https://repo.anaconda.com/archive/Anaconda3-2019.07-Linux-ppc64le.sh
 bash Anaconda3-2019.07-Linux-ppc64le.sh
 source ~/.bashrc
 conda config --set auto_activate_base True
 
 source ~/.bashrc
 
# conda environment install pytorch and torchvision: for power9
# note: requires pip2 python2 for this version pytorch
conda install -c engility pytorch
conda install -c engility torchvision

# I did this but I don't think necessary
conda install -c anaconda cudatoolkit=10.0

# switch to conda environment
conda create -n pave
conda activate pave

# build adios2 yourself
# note make sure to allow python bindings e.g.:
cmake -DADIOS2_USE_Fortran=ON -DCMAKE_INSTALL_PREFIX=$HOME/bin/adios2 -DADIOS2_USE_Python=ON ../ADIOS2
make -j16
make install

# change paths to include adios2 build 
export LD_LIBRARY_PATH=/path/to/personal/build/of/adios2/lib64:$LD_LIBRARY_PATH
export PYTHONPATH=/path/to/personal/build/of/adios2/lib64/python3.6/site-packages:$PYTHONPATH
export PATH=/path/to/personal/build/of/adios2/bin:$PATH

# gcc compiler needed to install mpi4py because anaconda not suited for power8 architecture
module load gcc/4.8.5  
pip install -v --no-binary mpi4py mpi4py
